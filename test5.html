<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Collision Alert Test</title>
  </head>
  <body>
    <h2>Collision Alert Test</h2>

    <div id="response"></div>

    <script>
      let intervalId;
      let savedUUIDs = []; // 로그인 시 저장한 UUID 리스트

      // 이전에 로그인 시 저장된 UUID 리스트를 미리 가져온다고 가정합니다.
      // 실제 구현에서는 세션 또는 로컬 저장소를 사용하여 저장할 수 있습니다.
      savedUUIDs = ["uuid1", "uuid2", "uuid3"]; // 예시로 미리 저장된 UUID 리스트

      function startRequesting() {
        intervalId = setInterval(requestCollisionUUIDs, 500); // 0.5초 간격으로 실행
      }

      function stopRequesting() {
        clearInterval(intervalId);
      }

      function requestCollisionUUIDs() {
        // API에 GET 요청 보내기
        fetch("http://47.186.58.92:8080/caruuids")
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            document.getElementById("response").innerText =
              JSON.stringify(data);

            // 충돌 예정 차량 UUID 리스트를 받아옴
            const collisionUUIDs = data.carUUIDs;

            // 저장된 UUID 리스트와 비교하여 충돌 예정 차량이 포함되었는지 확인
            for (let i = 0; i < collisionUUIDs.length; i++) {
              if (savedUUIDs.includes(collisionUUIDs[i])) {
                // 충돌 예정 차량이 포함되면 알람 보내기 (예시로 콘솔에 출력)
                console.log("Collision alert for UUID:", collisionUUIDs[i]);
                // 여기에 실제 알람을 보내는 코드를 추가할 수 있습니다.
              }
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            document.getElementById("response").innerText =
              "An error occurred. Please try again.";
          });
      }
    </script>

    <button onclick="startRequesting()">Start Requesting</button>
    <button onclick="stopRequesting()">Stop Requesting</button>
  </body>
</html>
